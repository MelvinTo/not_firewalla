#!/bin/bash

rc=0

: ${NM_DIR:=/home/pi/.node_modules}
: ${FIREWALLA_HOME:=/home/pi/firewalla}
source ${FIREWALLA_HOME}/platform/platform.sh

cd ${FIREWALLA_HOME}

CPU_PLATFORM=$(uname -m)
branch=$(git rev-parse --abbrev-ref HEAD)

set_origin() {
   branch=$1
   node_url=$2

   # make sure node_modules use the right repo
   ( cd $NM_DIR

   NM_URL=$(git remote get-url origin)
   
   if [[ "$NM_URL" != "$node_url" ]]; then
     git remote set-url origin $node_url

     git pull origin $branch
   fi  
   ) || return 1

   return 0
   
}

set_origin $branch $(get_node_modules_url) || rc=1

exit $rc




